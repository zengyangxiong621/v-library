!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios")):"function"==typeof define&&define.amd?define(["exports","axios"],t):t(e.SsoSdk={},e.axios);}(this,function(e,n){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;}function r(e,t){return e(t={exports:{}},t.exports),t.exports;}n=n&&n.hasOwnProperty("default")?n.default:n;var o=t(r(function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");},e.exports.default=e.exports,e.exports.__esModule=!0;})),i=t(r(function(e){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r);}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e;},e.exports.default=e.exports,e.exports.__esModule=!0;})),a={set:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:7;-2!==n&&(e="".concat(e,"=").concat(window.encodeURIComponent(t),";path=/;"),0<n&&((t=new Date).setTime(t.getTime()+864e5*n),e+="expires=".concat(t.toGMTString())),window.document.cookie=e);},get:function(e){e=new RegExp("(^| )".concat(e,"=([^;]*)(;|$)")),e=window.document.cookie.match(e);return null!==e?window.decodeURIComponent(e[2]):null;},delete:function(e){this.set(e,"",-1);}},c=t(r(function(t){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(e){return typeof e;}:t.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e;},t.exports.default=t.exports,t.exports.__esModule=!0,n(e);}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0;}));function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.href,e=new RegExp("(^|&)".concat(e,"=([^&]*)(&|$)"),"i"),e=(t.split("?")[1]||"").split("#")[0].match(e);return null!==e?window.decodeURIComponent(e[2]):null;}function u(e,t,n){a.set(e,t,n),window._sso_ticket=t;}function f(e){return a.get(e)||window._sso_ticket||"";}function h(e){a.delete(e),window._sso_ticket="";}function l(e,t){try{var n=new URL(window.location.href);n.searchParams.delete(e),n.searchParams.delete(t),window.history.replaceState("sso",null,n.href);}catch(e){}}!function(t){function e(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e};}};return a&&(e[Symbol.iterator]=function(){return e;}),e;}function r(e){return encodeURIComponent(e).replace(/%20/g,"+");}function i(e){return decodeURIComponent(String(e).replace(/\+/g," "));}var n,o,a=function(){try{return!!Symbol.iterator;}catch(e){return!1;}}();!function(){try{var e=t.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries;}catch(e){return!1;}}()&&((o=(n=function e(t){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var n=c(t);if("undefined"!==n)if("string"===n)""!==t&&this._fromString(t);else if(t instanceof e){var r=this;t.forEach(function(e,t){r.append(t,e);});}else{if(null===t||"object"!==n)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(t))for(var o=0;o<t.length;o++){var i=t[o];if("[object Array]"!==Object.prototype.toString.call(i)&&2===i.length)throw new TypeError("Expected [string, any] as entry at index "+o+" of URLSearchParams's input");this.append(i[0],i[1]);}else for(var a in t)t.hasOwnProperty(a)&&this.append(a,t[a]);}}).prototype).append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)];},o.delete=function(e){delete this._entries[e];},o.get=function(e){return e in this._entries?this._entries[e][0]:null;},o.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[];},o.has=function(e){return e in this._entries;},o.set=function(e,t){this._entries[e]=[String(t)];},o.forEach=function(e,t){for(var n in this._entries)if(this._entries.hasOwnProperty(n))for(var r=this._entries[n],o=0;o<r.length;o++)e.call(t,r[o],n,this);},o.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t);}),e(n);},o.values=function(){var t=[];return this.forEach(function(e){t.push(e);}),e(t);},o.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e]);}),e(n);},a&&(o[Symbol.iterator]=o.entries),o.toString=function(){var n=[];return this.forEach(function(e,t){n.push(r(t)+"="+r(e));}),n.join("&");},t.URLSearchParams=n);var s=t.URLSearchParams.prototype;"function"!=typeof s.sort&&(s.sort=function(){var n=this,r=[];this.forEach(function(e,t){r.push([t,e]),n._entries||n.delete(t);}),r.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0;}),n._entries&&(n._entries={});for(var e=0;e<r.length;e++)this.append(r[e][0],r[e][1]);}),"function"!=typeof s._fromString&&Object.defineProperty(s,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var n=[];this.forEach(function(e,t){n.push(t);});for(var t=0;t<n.length;t++)this.delete(n[t]);}for(var r,o=(e=e.replace(/^\?/,"")).split("&"),t=0;t<o.length;t++)r=o[t].split("="),this.append(i(r[0]),1<r.length?i(r[1]):"");}});}("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0),function(f){function e(){function e(e,t){"string"!=typeof e&&(e=String(e)),t&&"string"!=typeof t&&(t=String(t));var n,r=document;if(t&&(void 0===f.location||t!==f.location.href)){t=t.toLowerCase(),(n=(r=document.implementation.createHTMLDocument("")).createElement("base")).href=t,r.head.appendChild(n);try{if(0!==n.href.indexOf(t))throw new Error(n.href);}catch(e){throw new Error("URL unable to set base "+t+" due to "+e);}}var o=r.createElement("a");if(o.href=e,n&&(r.body.appendChild(o),o.href=o.href),(r=r.createElement("input")).type="url",r.value=e,":"===o.protocol||!/:/.test(o.href)||!r.checkValidity()&&!t)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:o});var i=new f.URLSearchParams(this.search),a=!0,s=!0,c=this;["append","delete","set"].forEach(function(e){var t=i[e];i[e]=function(){t.apply(i,arguments),a&&(s=!1,c.search=i.toString(),s=!0);};}),Object.defineProperty(this,"searchParams",{value:i,enumerable:!0});var u=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==u&&(u=this.search,s&&(a=!1,this.searchParams._fromString(this.search),a=!0));}});}var t=f.URL,n=e.prototype;["hash","host","hostname","port","protocol"].forEach(function(e){var t;t=e,Object.defineProperty(n,t,{get:function(){return this._anchorElement[t];},set:function(e){this._anchorElement[t]=e;},enumerable:!0});}),Object.defineProperty(n,"search",{get:function(){return this._anchorElement.search;},set:function(e){this._anchorElement.search=e,this._updateSearchParams();},enumerable:!0}),Object.defineProperties(n,{toString:{get:function(){var e=this;return function(){return e.href;};}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"");},set:function(e){this._anchorElement.href=e,this._updateSearchParams();},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/");},set:function(e){this._anchorElement.pathname=e;},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],e=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(e?":"+this._anchorElement.port:"");},enumerable:!0},password:{get:function(){return"";},set:function(e){},enumerable:!0},username:{get:function(){return"";},set:function(e){},enumerable:!0}}),e.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments);},e.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments);},f.URL=e;}if(!function(){try{var e;return(e=new f.URL("b","http://a")).pathname="c d","http://a/c%20d"===e.href&&e.searchParams;}catch(e){return!1;}}()&&e(),void 0!==f.location&&!("origin"in f.location)){var t=function(){return f.location.protocol+"//"+f.location.hostname+(f.location.port?":"+f.location.port:"");};try{Object.defineProperty(f.location,"origin",{get:t,enumerable:!0});}catch(e){setInterval(function(){f.location.origin=t();},100);}}}("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0);var p=Object.freeze({getParam:s,setTicket:u,getTicket:f,clearTicket:h,clearTicketParam:l});function d(n,r){return function(e){var t=e.data||{};if(0===e.errorCode)return n&&n(t,e),e;throw r&&r(t,e),e;};}var y=function(){function t(e){o(this,t);e=this.config=Object.assign({sso:"",key:"",stKey:"ticket",tgtKey:"tgt",expires:7},e);this.ssoAxios=n.create({baseURL:e.sso}),this.ssoAxios.interceptors.response.use(function(e){return e.data;});}return i(t,[{key:"autoSSO",value:function(){var e,t=this.config,n=t.key,r=t.stKey,o=t.tgtKey,t=s(r);if(t)e=this.validateST(t);else{if(!(t=s(o)||f(n)))return Promise.reject(new Error);e=this.getUserinfo(t);}return e.then(function(e){return l(r,o),e;},function(e){throw l(r,o),e;});}},{key:"logout",value:function(e){var t=this.config.key,n=d(function(){h(t);});return e=e||f(t),this.ssoAxios.delete("/logout",{headers:{ticket:e}}).then(n);}},{key:"getUserinfo",value:function(t){var n=this,e=this.config,r=e.key,o=e.expires,e=d(function(e){e.Ticket=t,u(r,t,o),n.userinfo=e;},function(){h(r);});return this.ssoAxios.get("/userinfo",{headers:{ticket:t}}).then(e);}},{key:"validate",value:function(e){var n=this,t=this.config,r=t.key,o=t.expires;return this.ssoAxios.get("/validate",{headers:e}).then(function(e){var t=e.data||{};if(0===e.errorCode&&t.IsValid)return u(r,t.Ticket,o),n.userinfo=t,e;throw h(r),e;});}},{key:"validateST",value:function(e){return this.validate({"s-ticket":e});}},{key:"validateTGT",value:function(e){return this.validate({ticket:e});}},{key:"JumpToLogin",value:function(e,t){var n=this.config.sso.replace("/api/v2","/login");window.location.href="".concat(t||n,"?service=").concat(window.encodeURIComponent(e||window.location.href));}}]),t;}();y.utils=p,y.axios=n,y.cookie=a,e.default=y,Object.defineProperty(e,"__esModule",{value:!0});});
